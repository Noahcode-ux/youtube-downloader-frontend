<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyberpunk YT Downloader</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
</head>
<body class="bg-black text-green-400 font-mono flex flex-col items-center justify-center min-h-screen">
  <div class="max-w-lg w-full p-6 bg-gray-900 rounded-2xl shadow-2xl border border-green-400">
    <h1 class="text-2xl mb-4 text-center">ðŸŽ¬ Cyberpunk YT Downloader</h1>

    <input id="url" type="text" placeholder="Enter YouTube URL"
      class="w-full p-2 mb-4 bg-black border border-green-500 rounded"/>

    <select id="format" class="w-full p-2 mb-4 bg-black border border-green-500 rounded">
      <option value="mp4">Video (MP4)</option>
      <option value="mp3">Audio (MP3)</option>
    </select>

    <button onclick="startDownload()"
      class="w-full p-2 bg-green-600 hover:bg-green-500 rounded-lg">Download</button>

    <div id="status" class="mt-4 text-sm"></div>
    <div class="w-full bg-gray-800 rounded-full h-3 mt-2">
      <div id="progressBar" class="bg-green-400 h-3 rounded-full transition-all" style="width:0%"></div>
    </div>
  </div>

  <script>
    const BACKEND = "https://yt-downloader-backend-pnk5.onrender.com";

    async function startDownload() {
      const url = document.getElementById("url").value;
      const format = document.getElementById("format").value;
      if (!url) return alert("Please enter a YouTube URL");

      document.getElementById("status").innerText = "â³ Starting download...";
      document.getElementById("progressBar").style.width = "0%";

      // Step 1: Ask backend to start download
      let res = await fetch(`${BACKEND}/download?url=${encodeURIComponent(url)}&format=${format}`);
      let data = await res.json();

      const videoId = data.video_id;
      pollProgress(videoId);
    }

    async function pollProgress(videoId) {
      let interval = setInterval(async () => {
        let res = await fetch(`${BACKEND}/progress/${videoId}`);
        let data = await res.json();

        if (data.status === "downloading") {
          document.getElementById("status").innerText =
            `Downloading... ${data.downloaded} | Speed: ${data.speed} | ETA: ${data.eta}`;
          document.getElementById("progressBar").style.width = data.downloaded;
        }

        if (data.status === "ready") {
          clearInterval(interval);
          document.getElementById("status").innerText = "âœ… Download complete!";
          document.getElementById("progressBar").style.width = "100%";

          // ðŸŽ‰ Confetti
          confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

          // Auto-download file
          let link = document.createElement("a");
          link.href = `${BACKEND}/file/${videoId}`;
          link.download = data.file || "download";
          link.click();
        }
      }, 2000);
    }
  </script>
</body>
</html>



